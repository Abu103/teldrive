import{a as e,j as s,M as a,$ as t,_ as r,P as i,S as o,a0 as l,l as n,a1 as d,v as c,C as u,s as p,c as m}from"./index-CnEFNa9w.js";import{e as h,k as x,l as f,v as j,a as w,o as g,w as v,q as N,r as P,s as y,t as S,P as b,F as k,c as F}from"./preview-Durwi9tP.js";const C=e.forwardRef(((e,a)=>s.jsxs("svg",{viewBox:"0 0 32 32",width:"1.5rem",height:"1.5rem",ref:a,...e,children:[s.jsx("path",{fill:"currentColor",d:"M21 2a8.998 8.998 0 0 0-8.612 11.612L2 24v6h6l10.388-10.388A9 9 0 1 0 21 2m0 16a7 7 0 0 1-2.032-.302l-1.147-.348l-.847.847l-3.181 3.181L12.414 20L11 21.414l1.379 1.379l-1.586 1.586L9.414 23L8 24.414l1.379 1.379L7.172 28H4v-3.172l9.802-9.802l.848-.847l-.348-1.147A7 7 0 1 1 21 18"}),s.jsx("circle",{cx:22,cy:10,r:2,fill:"currentColor"})]})));let L=!0;const A=a("/_share/share/$id"),M=new Map,U=[h.UploadFiles.id,h.CreateFolder.id,h.CutFiles.id,h.SelectMode.id,h.PasteFiles.id,h.RenameFile.id,h.DeleteFiles.id],z=e.memo((({password:a})=>{const{id:n}=A.useParams(),{path:d}=A.useSearch(),c=e.useRef(null),{breakpoint:u}=x(o),p={id:n,password:a,path:d||""},{data:{name:m,type:k}}=t.useSuspenseQuery("get","/shares/{id}",{params:{path:{id:n}}}),{data:F,fetchNextPage:C,hasNextPage:z,isFetchingNextPage:E}=f(l.list(p)),I=j(p),T=e.useMemo((()=>"file"===k?[]:r(m,p.path).map((([e,s],a)=>({id:a+e,name:e,path:s,isDir:!0,chain:!0})))),[p.path,m,k]),R=w((e=>e.open)),$=w((e=>e.operation));return e.useEffect((()=>{if(!L)return setTimeout((()=>{var e,s;null==(s=c.current)||s.scrollTo({top:(null==(e=M.get(n+d))?void 0:e.scrollTop)??0,left:0})}),0),()=>{var e;c.current&&void 0!==c.current.getState&&(null==(e=c.current)||e.getState((e=>M.set(n+d,e))))};L=!1}),[n,d]),s.jsxs("div",{className:"size-full m-auto",children:[s.jsxs(g,{files:F,folderChain:T,onFileAction:I(),fileActions:v,breakpoint:u,defaultFileViewActionId:i,disableEssentailFileActions:U,children:[s.jsx(N,{breakpoint:u}),s.jsx(P,{className:"pt-2"}),s.jsx(y,{hasNextPage:z,isNextPageLoading:E,loadNextPage:C,ref:c}),s.jsx(S,{})]}),$===h.OpenFiles.id&&R&&s.jsx(b,{shareId:p.id,files:F,view:"shared",path:""})]})})),E=n("/_share/share/$id")({component:function(){const{id:a}=E.useParams(),{data:r}=t.useSuspenseQuery("get","/shares/{id}",{params:{path:{id:a}}}),[i,o]=d("password",""),[l,n]=e.useState(r.protected&&!!i||!r.protected);if(!l)return s.jsx(I,{id:a,setUnlockPassword:o,setUnlocked:n});return!r.protected||l?s.jsx(z,{password:i}):null}});function I({id:a,setUnlocked:r,setUnlockPassword:i}){const[o,l]=e.useState(!1),{control:n,handleSubmit:d,setError:h}=c({defaultValues:{password:""}}),x=()=>l((e=>!e)),f=t.useMutation("post","/shares/{id}/unlock",{onSuccess:()=>{r(!0)},onError:()=>{h("password",{message:"Invalid password"})}}),j=e.useCallback((async({password:e})=>{f.mutateAsync({params:{path:{id:a}},body:{password:e}}).then((()=>i(e)))}),[]);return s.jsxs("form",{onSubmit:d(j),className:"m-auto flex rounded-large max-w-md flex-col justify-center items-center bg-surface gap-6 p-6",children:[s.jsx("div",{className:"size-14 bg-secondary-container flex items-center justify-center rounded",children:s.jsx(C,{className:"size-8 text-on-secondary-container"})}),s.jsx("h1",{className:"font-medium",children:"This link is password protected"}),s.jsx(u,{name:"password",control:n,rules:{required:!0},render:({field:e,fieldState:{error:a}})=>s.jsx(p,{size:"lg",placeholder:"Enter password",className:"max-w-xs",variant:"bordered",isInvalid:!!a,errorMessage:null==a?void 0:a.message,...e,"aria-autocomplete":"none",autoComplete:"off",autoSave:"off",type:o?"text":"password",endContent:s.jsx(m,{isIconOnly:!0,className:"size-8 min-w-8",variant:"text",onPress:x,children:o?s.jsx(k,{}):s.jsx(F,{})})})}),s.jsx(m,{isLoading:f.isPending,fullWidth:!0,type:"submit",variant:"filledTonal",className:"max-w-xs text-inherit",children:"Unlock"})]})}export{E as Route};
