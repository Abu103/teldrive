var e,s,a,t=Object.defineProperty,r=e=>{throw TypeError(e)},n=(e,s,a)=>((e,s,a)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a)(e,"symbol"!=typeof s?s+"":s,a),i=(e,s,a)=>s.has(e)||r("Cannot "+a),l=(e,s,a)=>(i(e,s,"read from private field"),a?a.call(e):s.get(e)),o=(e,s,a)=>s.has(e)?r("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,a),c=(e,s,a,t)=>(i(e,s,"write to private field"),t?t.call(e,a):s.set(e,a),a),d=(e,s,a,t)=>({set _(t){c(e,s,t,a)},get _(){return l(e,s,t)}});import{n as u,o as h,a as f,j as m,f as p,c as x,p as v,$ as g,s as y,t as j,v as b,w,C as N,x as C,y as S,z as k,g as F,A as M,B as T,D as I,E as P,F as z,G as O,H as D,I as L,J as q,K as A,M as E,N as B,O as R,P as $,Q as U,R as _,S as K,l as V}from"./index-CnEFNa9w.js";import{u as W,a as H,b as Q,F as G,c as Z,m as Y,d as J,C as X,e as ee,f as se,g as ae,h as te,i as re,j as ne,k as ie,l as le,n as oe,o as ce,p as de,q as ue,r as he,s as fe,t as me,P as pe}from"./preview-Durwi9tP.js";var xe=u(((e,s)=>{const{as:a,children:t,className:r,...n}=e,{slots:i,classNames:l,bodyId:o,setBodyMounted:c}=W(),d=h(s),u=a||"div";return f.useEffect((()=>(c(!0),()=>c(!1))),[c]),m.jsx(u,{ref:d,className:i.body({class:p(null==l?void 0:l.body,r)}),id:o,...n,children:t})}));xe.displayName="TwMaterial.ModalBody";var ve=xe,ge=u(((e,s)=>{const{as:a,children:t,className:r,...n}=e,{slots:i,classNames:l}=W(),o=h(s),c=a||"footer";return m.jsx(c,{ref:o,className:i.footer({class:p(null==l?void 0:l.footer,r)}),...n,children:t})}));ge.displayName="TwMaterial.ModalFooter";var ye=ge,je=u(((e,s)=>{const{as:a,children:t,className:r,...n}=e,{slots:i,classNames:l,headerId:o,setHeaderMounted:c}=W(),d=h(s),u=a||"header";return f.useEffect((()=>(c(!0),()=>c(!1))),[c]),m.jsx(u,{ref:d,className:i.header({class:p(null==l?void 0:l.header,r)}),id:o,...n,children:t})}));je.displayName="TwMaterial.ModalHeader";var be=je;const we=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsx("path",{fill:"currentColor",d:"M9 16.17L5.53 12.7a.996.996 0 1 0-1.41 1.41l4.18 4.18c.39.39 1.02.39 1.41 0L20.29 7.71a.996.996 0 1 0-1.41-1.41z"})}))),Ne=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsxs("g",{fill:"none",fillRule:"evenodd",children:[m.jsx("path",{d:"m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"}),m.jsx("path",{fill:"currentColor",d:"M9 2a2 2 0 0 0-2 2v2h2V4h11v11h-2v2h2a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM4 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zm0 2h11v11H4z"})]})}))),Ce=({value:e,...s})=>{const{copy:a,copied:t}=function({timeout:e=2e3}={}){const[s,a]=f.useState(null),[t,r]=f.useState(!1),[n,i]=f.useState(null),l=f.useCallback((()=>{n&&clearTimeout(n)}),[n]),o=f.useCallback((s=>{l(),i(setTimeout((()=>r(!1)),e)),r(s)}),[l,e]);return{copy:f.useCallback((e=>{"clipboard"in navigator?navigator.clipboard.writeText(e).then((()=>o(!0))).catch((e=>a(e))):a(new Error("useClipboard: navigator.clipboard is not supported"))}),[o]),reset:f.useCallback((()=>{r(!1),a(null),l()}),[l]),error:s,copied:t}}();return m.jsxs(x,{isIconOnly:!0,className:"z-50 border-1 before:content-[''] before:block before:z-[-1] before:absolute before:inset-0",variant:"filledTonal",onPress:()=>{a(e)},disableRipple:!0,...s,children:[m.jsx(we,{className:"absolute size-6 opacity-0 scale-50  data-[visible=true]:opacity-100 data-[visible=true]:scale-100 transition-transform-opacity","data-visible":t}),m.jsx(Ne,{className:"absolute size-6 opacity-0 scale-50 data-[visible=true]:opacity-100 data-[visible=true]:scale-100 transition-transform-opacity","data-visible":!t})]})},Se=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsx("path",{fill:"currentColor",d:"M18.3 5.71a.996.996 0 0 0-1.41 0L12 10.59L7.11 5.7A.996.996 0 1 0 5.7 7.11L10.59 12L5.7 16.89a.996.996 0 1 0 1.41 1.41L12 13.41l4.89 4.89a.996.996 0 1 0 1.41-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4"})}))),ke=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsx("path",{fill:"currentColor",d:"M12 17a2 2 0 0 1-2-2c0-1.11.89-2 2-2a2 2 0 0 1 2 2a2 2 0 0 1-2 2m6 3V10H6v10zm0-12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10c0-1.11.89-2 2-2h1V6a5 5 0 0 1 5-5a5 5 0 0 1 5 5v2zm-6-5a3 3 0 0 0-3 3v2h6V6a3 3 0 0 0-3-3"})}))),Fe=f.memo((({queryKey:e,handleClose:s})=>{const a=v(),t=g.useMutation("patch","/files/{id}",{onSuccess:()=>{a.invalidateQueries({queryKey:e})}}),{currentFile:r,actions:n}=H(Q((e=>({currentFile:e.currentFile,actions:e.actions})))),i=f.useCallback((e=>{e.preventDefault(),t.mutateAsync({params:{path:{id:r.id}},body:{name:null==r?void 0:r.name}}).then(s)}),[r.name,r.id]);return m.jsxs(m.Fragment,{children:[m.jsx(be,{className:"flex flex-col gap-1",children:"Rename"}),m.jsx(ve,{as:"form",id:"rename-form",onSubmit:i,children:m.jsx(y,{size:"lg",variant:"bordered",classNames:{inputWrapper:"border-primary border-large"},autoFocus:!0,value:r.name,onValueChange:e=>n.setCurrentFile({...r,name:e})})}),m.jsxs(ye,{children:[m.jsx(x,{className:"font-normal",variant:"text",onPress:s,children:"Close"}),m.jsx(x,{type:"submit",className:"font-normal",variant:"filledTonal",form:"rename-form",isDisabled:t.isPending||!r.name,isLoading:t.isPending,children:"Rename"})]})]})})),Me=f.memo((({queryKey:e,handleClose:s})=>{const a=v(),{path:t}=j({from:"/_authed/$view"}),r=g.useMutation("post","/files",{onSuccess:()=>{a.invalidateQueries({queryKey:e})}}),{currentFile:n,actions:i}=H(Q((e=>({currentFile:e.currentFile,actions:e.actions})))),l=f.useCallback((e=>{e.preventDefault(),r.mutateAsync({body:{name:n.name,type:"folder",path:t||"/"}}).then((()=>s()))}),[n.name]);return m.jsxs(m.Fragment,{children:[m.jsx(be,{className:"flex flex-col gap-1",children:"Create Folder"}),m.jsx(ve,{as:"form",id:"create-folder-form",onSubmit:l,children:m.jsx(y,{size:"lg",variant:"bordered",classNames:{inputWrapper:"border-primary border-large"},placeholder:"Folder Name or Path",autoFocus:!0,value:null==n?void 0:n.name,onValueChange:e=>i.setCurrentFile({...n,name:e})})}),m.jsxs(ye,{children:[m.jsx(x,{className:"font-normal",variant:"text",onPress:s,children:"Close"}),m.jsx(x,{type:"submit",form:"create-folder-form",className:"font-normal",variant:"filledTonal",isDisabled:r.isPending||!n.name,isLoading:r.isPending,children:r.isPending?"Creating":"Create"})]})]})})),Te=f.memo((({handleClose:e,queryKey:s})=>{const a=v(),t=g.useMutation("post","/files/delete",{onSuccess:()=>{a.invalidateQueries({queryKey:s})}}),r=H((e=>e.selectedFiles)),n=f.useCallback((()=>{t.mutateAsync({body:{ids:r}}),e()}),[r]);return m.jsxs(m.Fragment,{children:[m.jsx(be,{className:"flex flex-col gap-1",children:"Delete Files"}),m.jsx(ve,{children:m.jsx("h1",{className:"text-large font-medium mt-2",children:`Are you sure to delete ${r.length} file${r.length>1?"s":""} ?`})}),m.jsxs(ye,{children:[m.jsx(x,{className:"font-normal",variant:"text",onPress:e,children:"No"}),m.jsx(x,{variant:"filledTonal",classNames:{base:"font-normal"},onPress:n,children:"Yes"})]})]})})),Ie={expirationDate:"",password:""},Pe=f.memo((({handleClose:e})=>{const s=H((e=>e.currentFile)),a=v(),{control:t,handleSubmit:r}=b({defaultValues:Ie}),n=g.queryOptions("get","/files/{id}/share",{params:{path:{id:s.id}}}),{data:i,isLoading:l}=w(n),o=g.useMutation("post","/files/{id}/share",{onSuccess:()=>{a.invalidateQueries({queryKey:n.queryKey}),a.invalidateQueries({queryKey:["Files_list","shared"]})}}),c=g.useMutation("delete","/files/{id}/share",{onSuccess:()=>{a.invalidateQueries({queryKey:["Files_list","shared"]})}}),[d,u]=f.useState(!1),[h,p]=f.useState(""),[j,F]=f.useState(!1),M=f.useCallback((()=>{u((e=>(e||r((e=>{const a={};e.expirationDate&&(a.expirationDate=`${e.expirationDate}${(new Date).toISOString().slice(10)}`),e.password&&(a.password=e.password),o.mutateAsync({params:{path:{id:s.id}},body:a})}))(),e&&(c.mutateAsync({params:{path:{id:s.id}}}),p("")),!e)))}),[]);return f.useEffect((()=>{i&&(u(!0),p(`${window.location.origin}/share/${i.id}`))}),[i]),m.jsxs(m.Fragment,{children:[m.jsxs(be,{className:"flex items-center justify-between ",children:["Share Files",m.jsx(x,{size:"sm",variant:"text",isIconOnly:!0,onPress:e,children:m.jsx(Se,{})})]}),m.jsxs(ve,{children:[m.jsxs("form",{className:"grid grid-cols-6 gap-8 p-2 w-full overflow-y-auto",children:[m.jsxs("div",{className:"col-span-6 xs:col-span-3",children:[m.jsx("p",{className:"text-lg font-medium",children:"Set expiration date"}),m.jsx("p",{className:"text-sm font-normal text-on-surface-variant",children:"Link expiration date"})]}),m.jsx(N,{name:"expirationDate",control:t,render:({field:e,fieldState:{error:s}})=>m.jsx(y,{size:"lg",className:"col-span-6 xs:col-span-3",variant:"bordered",isInvalid:!!s,errorMessage:null==s?void 0:s.message,type:"date",min:C(),...e})}),m.jsxs("div",{className:"col-span-6 xs:col-span-3",children:[m.jsx("p",{className:"text-lg font-medium",children:"Set link password"}),m.jsx("p",{className:"text-sm font-normal text-on-surface-variant",children:"Public link password"})]}),m.jsx(N,{name:"password",control:t,render:({field:e,fieldState:{error:s}})=>m.jsx(y,{size:"lg",className:"col-span-6 xs:col-span-3",variant:"bordered",autoComplete:"off",isInvalid:!!s,errorMessage:null==s?void 0:s.message,type:j?"text":"password",...e,endContent:m.jsx(x,{isIconOnly:!0,className:"size-8 min-w-8",variant:"text",onPress:()=>F((e=>!e)),children:j?m.jsx(G,{}):m.jsx(Z,{})})})})]}),m.jsx(S,{}),m.jsxs("div",{className:"flex justify-between",children:[m.jsxs("h1",{className:"text-large font-medium mt-2",children:["Sharing ",d?"On":"Off"]}),m.jsxs("div",{className:"flex items-center gap-3",children:[(null==i?void 0:i.protected)&&m.jsx(ke,{className:"text-primary"}),m.jsx(k,{size:"md",isSelected:d,onChange:M})]})]})]}),m.jsxs(ye,{children:[m.jsx(y,{isDisabled:l||!i,fullWidth:!0,variant:"bordered",readOnly:!0,value:h}),m.jsx(Ce,{value:h,isDisabled:l||!i})]})]})})),ze=f.memo((({queryKey:e})=>{const{open:s,operation:a,actions:t}=H(Q((e=>({open:e.open,operation:e.operation,actions:e.actions})))),r=f.useCallback((()=>t.set({open:!1})),[]);return m.jsx(Y,{isOpen:s,size:"md",classNames:{wrapper:"overflow-hidden",base:"bg-surface w-full shadow-none"},placement:"center",onClose:r,hideCloseButton:!0,children:m.jsx(J,{children:()=>{switch(a){case ee.RenameFile.id:return m.jsx(Fe,{queryKey:e,handleClose:r});case ee.CreateFolder.id:return m.jsx(Me,{queryKey:e,handleClose:r});case ee.DeleteFiles.id:return m.jsx(Te,{queryKey:e,handleClose:r});case X.ShareFiles.id:return m.jsx(Pe,{handleClose:r});default:return null}}})})})),Oe=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsx("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8m4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4l8-8z"})}))),De=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsx("path",{fill:"currentColor",d:"M12 7c.55 0 1 .45 1 1v4c0 .55-.45 1-1 1s-1-.45-1-1V8c0-.55.45-1 1-1m-.01-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8s8 3.58 8 8s-3.58 8-8 8m1-3h-2v-2h2z"})}))),Le=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 48 48",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:4,children:[m.jsx("path",{d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4S4 12.954 4 24s8.954 20 20 20Z"}),m.jsx("path",{strokeLinecap:"round",d:"M29.657 18.343L18.343 29.657m0-11.314l11.314 11.314"})]})}))),qe=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 48 48",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:4,children:[m.jsx("path",{d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4S4 12.954 4 24s8.954 20 20 20Z"}),m.jsx("path",{strokeLinecap:"round",d:"m33 21l-9 9l-9-9"})]})}))),Ae=f.forwardRef(((e,s)=>m.jsxs("svg",{viewBox:"0 0 48 48",width:"1.5rem",height:"1.5rem",ref:s,...e,children:[m.jsx("defs",{children:m.jsx("path",{id:"ipOUpC0",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4S4 12.954 4 24s8.954 20 20 20"})}),m.jsxs("g",{fill:"none",stroke:"currentColor",strokeWidth:4,children:[m.jsx("use",{href:"#ipOUpC0",clipRule:"evenodd"}),m.jsx("use",{href:"#ipOUpC0",strokeLinejoin:"round"}),m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m33 27l-9-9l-9 9"})]})]}))),Ee=f.forwardRef(((e,s)=>m.jsx("svg",{viewBox:"0 0 24 24",width:"1.5rem",height:"1.5rem",ref:s,...e,children:m.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,children:[m.jsx("path",{strokeDasharray:64,strokeDashoffset:64,d:"M5.64 5.64c3.51 -3.51 9.21 -3.51 12.73 0c3.51 3.51 3.51 9.21 0 12.73c-3.51 3.51 -9.21 3.51 -12.73 0c-3.51 -3.51 -3.51 -9.21 -0 -12.73Z",children:m.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",dur:"0.6s",values:"64;0"})}),m.jsx("path",{strokeDasharray:20,strokeDashoffset:20,d:"M6 6l12 12",children:m.jsx("animate",{fill:"freeze",attributeName:"stroke-dashoffset",begin:"0.6s",dur:"0.2s",values:"20;0"})})]})})));var Be,Re,$e,Ue,_e,Ke,Ve,We,He,Qe,Ge,Ze,Ye,Je={exports:{}},Xe={exports:{}};function es(){if($e)return Re;$e=1;var e={utf8:{stringToBytes:function(s){return e.bin.stringToBytes(unescape(encodeURIComponent(s)))},bytesToString:function(s){return decodeURIComponent(escape(e.bin.bytesToString(s)))}},bin:{stringToBytes:function(e){for(var s=[],a=0;a<e.length;a++)s.push(255&e.charCodeAt(a));return s},bytesToString:function(e){for(var s=[],a=0;a<e.length;a++)s.push(String.fromCharCode(e[a]));return s.join("")}}};return Re=e}function ss(){if(_e)return Ue;function e(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}return _e=1,Ue=function(s){return null!=s&&(e(s)||function(s){return"function"==typeof s.readFloatLE&&"function"==typeof s.slice&&e(s.slice(0,0))}(s)||!!s._isBuffer)}}const as=F((Ke||(Ke=1,Be||(Be=1,Ve="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",We={rotl:function(e,s){return e<<s|e>>>32-s},rotr:function(e,s){return e<<32-s|e>>>s},endian:function(e){if(e.constructor==Number)return 16711935&We.rotl(e,8)|4278255360&We.rotl(e,24);for(var s=0;s<e.length;s++)e[s]=We.endian(e[s]);return e},randomBytes:function(e){for(var s=[];e>0;e--)s.push(Math.floor(256*Math.random()));return s},bytesToWords:function(e){for(var s=[],a=0,t=0;a<e.length;a++,t+=8)s[t>>>5]|=e[a]<<24-t%32;return s},wordsToBytes:function(e){for(var s=[],a=0;a<32*e.length;a+=8)s.push(e[a>>>5]>>>24-a%32&255);return s},bytesToHex:function(e){for(var s=[],a=0;a<e.length;a++)s.push((e[a]>>>4).toString(16)),s.push((15&e[a]).toString(16));return s.join("")},hexToBytes:function(e){for(var s=[],a=0;a<e.length;a+=2)s.push(parseInt(e.substr(a,2),16));return s},bytesToBase64:function(e){for(var s=[],a=0;a<e.length;a+=3)for(var t=e[a]<<16|e[a+1]<<8|e[a+2],r=0;r<4;r++)8*a+6*r<=8*e.length?s.push(Ve.charAt(t>>>6*(3-r)&63)):s.push("=");return s.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var s=[],a=0,t=0;a<e.length;t=++a%4)0!=t&&s.push((Ve.indexOf(e.charAt(a-1))&Math.pow(2,-2*t+8)-1)<<2*t|Ve.indexOf(e.charAt(a))>>>6-2*t);return s}},Xe.exports=We),He=Xe.exports,Qe=es().utf8,Ge=ss(),Ze=es().bin,(Ye=function(e,s){e.constructor==String?e=s&&"binary"===s.encoding?Ze.stringToBytes(e):Qe.stringToBytes(e):Ge(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var a=He.bytesToWords(e),t=8*e.length,r=1732584193,n=-271733879,i=-1732584194,l=271733878,o=0;o<a.length;o++)a[o]=16711935&(a[o]<<8|a[o]>>>24)|4278255360&(a[o]<<24|a[o]>>>8);a[t>>>5]|=128<<t%32,a[14+(t+64>>>9<<4)]=t;var c=Ye._ff,d=Ye._gg,u=Ye._hh,h=Ye._ii;for(o=0;o<a.length;o+=16){var f=r,m=n,p=i,x=l;r=c(r,n,i,l,a[o+0],7,-680876936),l=c(l,r,n,i,a[o+1],12,-389564586),i=c(i,l,r,n,a[o+2],17,606105819),n=c(n,i,l,r,a[o+3],22,-1044525330),r=c(r,n,i,l,a[o+4],7,-176418897),l=c(l,r,n,i,a[o+5],12,1200080426),i=c(i,l,r,n,a[o+6],17,-1473231341),n=c(n,i,l,r,a[o+7],22,-45705983),r=c(r,n,i,l,a[o+8],7,1770035416),l=c(l,r,n,i,a[o+9],12,-1958414417),i=c(i,l,r,n,a[o+10],17,-42063),n=c(n,i,l,r,a[o+11],22,-1990404162),r=c(r,n,i,l,a[o+12],7,1804603682),l=c(l,r,n,i,a[o+13],12,-40341101),i=c(i,l,r,n,a[o+14],17,-1502002290),r=d(r,n=c(n,i,l,r,a[o+15],22,1236535329),i,l,a[o+1],5,-165796510),l=d(l,r,n,i,a[o+6],9,-1069501632),i=d(i,l,r,n,a[o+11],14,643717713),n=d(n,i,l,r,a[o+0],20,-373897302),r=d(r,n,i,l,a[o+5],5,-701558691),l=d(l,r,n,i,a[o+10],9,38016083),i=d(i,l,r,n,a[o+15],14,-660478335),n=d(n,i,l,r,a[o+4],20,-405537848),r=d(r,n,i,l,a[o+9],5,568446438),l=d(l,r,n,i,a[o+14],9,-1019803690),i=d(i,l,r,n,a[o+3],14,-187363961),n=d(n,i,l,r,a[o+8],20,1163531501),r=d(r,n,i,l,a[o+13],5,-1444681467),l=d(l,r,n,i,a[o+2],9,-51403784),i=d(i,l,r,n,a[o+7],14,1735328473),r=u(r,n=d(n,i,l,r,a[o+12],20,-1926607734),i,l,a[o+5],4,-378558),l=u(l,r,n,i,a[o+8],11,-2022574463),i=u(i,l,r,n,a[o+11],16,1839030562),n=u(n,i,l,r,a[o+14],23,-35309556),r=u(r,n,i,l,a[o+1],4,-1530992060),l=u(l,r,n,i,a[o+4],11,1272893353),i=u(i,l,r,n,a[o+7],16,-155497632),n=u(n,i,l,r,a[o+10],23,-1094730640),r=u(r,n,i,l,a[o+13],4,681279174),l=u(l,r,n,i,a[o+0],11,-358537222),i=u(i,l,r,n,a[o+3],16,-722521979),n=u(n,i,l,r,a[o+6],23,76029189),r=u(r,n,i,l,a[o+9],4,-640364487),l=u(l,r,n,i,a[o+12],11,-421815835),i=u(i,l,r,n,a[o+15],16,530742520),r=h(r,n=u(n,i,l,r,a[o+2],23,-995338651),i,l,a[o+0],6,-198630844),l=h(l,r,n,i,a[o+7],10,1126891415),i=h(i,l,r,n,a[o+14],15,-1416354905),n=h(n,i,l,r,a[o+5],21,-57434055),r=h(r,n,i,l,a[o+12],6,1700485571),l=h(l,r,n,i,a[o+3],10,-1894986606),i=h(i,l,r,n,a[o+10],15,-1051523),n=h(n,i,l,r,a[o+1],21,-2054922799),r=h(r,n,i,l,a[o+8],6,1873313359),l=h(l,r,n,i,a[o+15],10,-30611744),i=h(i,l,r,n,a[o+6],15,-1560198380),n=h(n,i,l,r,a[o+13],21,1309151649),r=h(r,n,i,l,a[o+4],6,-145523070),l=h(l,r,n,i,a[o+11],10,-1120210379),i=h(i,l,r,n,a[o+2],15,718787259),n=h(n,i,l,r,a[o+9],21,-343485551),r=r+f>>>0,n=n+m>>>0,i=i+p>>>0,l=l+x>>>0}return He.endian([r,n,i,l])})._ff=function(e,s,a,t,r,n,i){var l=e+(s&a|~s&t)+(r>>>0)+i;return(l<<n|l>>>32-n)+s},Ye._gg=function(e,s,a,t,r,n,i){var l=e+(s&t|a&~t)+(r>>>0)+i;return(l<<n|l>>>32-n)+s},Ye._hh=function(e,s,a,t,r,n,i){var l=e+(s^a^t)+(r>>>0)+i;return(l<<n|l>>>32-n)+s},Ye._ii=function(e,s,a,t,r,n,i){var l=e+(a^(s|~t))+(r>>>0)+i;return(l<<n|l>>>32-n)+s},Ye._blocksize=16,Ye._digestsize=16,Je.exports=function(e,s){if(null==e)throw new Error("Illegal argument "+e);var a=He.wordsToBytes(Ye(e,s));return s&&s.asBytes?a:s&&s.asString?Ze.bytesToString(a):He.bytesToHex(a)}),Je.exports));class ts{constructor(e){n(this,"value"),n(this,"next"),this.value=e}}class rs{constructor(){o(this,e),o(this,s),o(this,a),this.clear()}enqueue(t){const r=new ts(t);l(this,e)?(l(this,s).next=r,c(this,s,r)):(c(this,e,r),c(this,s,r)),d(this,a)._++}dequeue(){const s=l(this,e);if(s)return c(this,e,l(this,e).next),d(this,a)._--,s.value}peek(){if(l(this,e))return l(this,e).value}clear(){c(this,e,void 0),c(this,s,void 0),c(this,a,0)}get size(){return l(this,a)}*[Symbol.iterator](){let s=l(this,e);for(;s;)yield s.value,s=s.next}}function ns(e){is(e);const s=new rs;let a=0;const t=()=>{a<e&&s.size>0&&(s.dequeue()(),a++)},r=async(e,s,r)=>{const n=(async()=>e(...r))();s(n);try{await n}catch{}a--,t()},n=(n,...i)=>new Promise((l=>{((n,i,l)=>{new Promise((e=>{s.enqueue(e)})).then(r.bind(void 0,n,i,l)),(async()=>{await Promise.resolve(),a<e&&t()})()})(n,l,i)}));return Object.defineProperties(n,{activeCount:{get:()=>a},pendingCount:{get:()=>s.size},clearQueue:{value(){s.clear()}},concurrency:{get:()=>e,set(r){is(r),e=r,queueMicrotask((()=>{for(;a<e&&s.size>0;)t()}))}}}),n}function is(e){if(!Number.isInteger(e)&&e!==Number.POSITIVE_INFINITY||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up")}e=new WeakMap,s=new WeakMap,a=new WeakMap;const ls=(e,s,a,t,r)=>new Promise(((n,i)=>{const l=new XMLHttpRequest,o=new URL(e);for(const e of Object.keys(a))o.searchParams.append(e,String(a[e]));t.addEventListener("abort",(()=>l.abort())),l.open("POST",o.href,!0),l.setRequestHeader("Content-Type","application/octet-stream"),l.responseType="json",l.upload.onprogress=e=>e.lengthComputable&&r(e.loaded/e.total*100),l.onload=()=>{r(100),n(l.response)},l.onabort=()=>{i(new Error("Upload aborted"))},l.onerror=()=>{i(new Error("Upload failed"))},l.send(s)})),os=f.memo((({id:e})=>{const{status:s,progress:a,file:t}=se((s=>s.fileMap[e])),r=se((e=>e.actions.removeFile)),{name:n,size:i}=t,{icon:l,colorCode:o}=ae({name:n,isDir:!1,id:""}),c=f.useMemo((()=>s===te.UPLOADING?`${M(a/100*i)} of ${M(i)}`:s===te.UPLOADED?`${M(i)}`:""),[a,i,s]),d=f.useCallback((()=>s===te.NOT_STARTED||s===te.UPLOADING?m.jsx(x,{onPress:()=>r(e),className:"text-inherit",variant:"text",isIconOnly:!0,children:m.jsx(Se,{})}):s===te.UPLOADED?m.jsx(x,{className:"text-green-600",variant:"text",isIconOnly:!0,children:m.jsx(Oe,{})}):s===te.FAILED?m.jsx(x,{className:"text-red-600",variant:"text",isIconOnly:!0,children:m.jsx(De,{})}):m.jsx(x,{className:"text-gray-800",variant:"text",isIconOnly:!0,children:m.jsx(Ee,{})})),[s,e,r]);return m.jsxs("div",{className:"flex size-full items-center gap-3",children:[m.jsx("div",{className:"size-8 grid rounded-lg shrink-0",style:{backgroundColor:`${re[o]}1F`},children:m.jsx(ne,{className:"size-5 text-center min-w-5 place-self-center text-primary",icon:l,style:{color:re[o]}})}),m.jsxs("div",{className:"flex flex-col gap-2 truncate flex-1",children:[m.jsx("p",{title:n,className:"truncate text-base font-normal",children:n}),c&&m.jsxs(m.Fragment,{children:[m.jsx("div",{style:{width:`${a}%`},className:"bg-primary h-0.5 w-0 transition-[width] duration-300 ease-in"}),m.jsx("p",{className:"text-sm font-normal",children:c})]})]}),d()]})})),cs=({queryKey:e})=>{const{fileIds:s,currentFile:a,collapse:t,fileDialogOpen:r,actions:n}=se(Q((e=>({fileIds:e.filesIds,fileMap:e.fileMap,currentFile:e.fileMap[e.currentFileId],collapse:e.collapse,actions:e.actions,fileDialogOpen:e.fileDialogOpen})))),{settings:i}=T(),[l]=I(),o=f.useRef(null),c=f.useCallback((()=>{var e;null==(e=null==o?void 0:o.current)||e.click(),window.addEventListener("focus",(()=>n.setFileDialogOpen(!1)),{once:!0})}),[]);f.useEffect((()=>{r&&c()}),[r]);const d=f.useCallback((e=>{const s=e.target.files?Array.from(e.target.files).filter((e=>e.size>0)):[];s.length>0&&n.addFiles(s)}),[]),u=v(),h=g.useMutation("post","/files",{onSuccess:()=>{u.invalidateQueries({queryKey:e})}}),{path:y}=j({from:"/_authed/$view"});return f.useEffect((()=>{(null==a?void 0:a.id)&&(null==a?void 0:a.status)===te.NOT_STARTED&&(n.setFileUploadStatus(a.id,te.UPLOADING),(async(e,s,a,t,r,n,i,l,o)=>{const c=e.name,d=(await L.GET("/files",{params:{query:{path:s,name:c,operation:"find"}}})).data;if(d&&d.items.length>0)throw new Error("File already exists");const u=Math.ceil(e.size/a),h=ns(r),f=as(`${s}/${c}${e.size.toString()}${q(e.lastModified)}${t}`),m=`${window.location.origin}/api/uploads/${f}`,p=(await L.GET("/uploads/{id}",{params:{path:{id:f}}})).data;let x=0;p.length>0&&(x=p[0].channelId);const v=[],g=[];for(let N=0;N<u;N++)(null==p?void 0:p.findIndex((e=>e.partNo===N+1)))>-1?g[N]=100:v.push(h((()=>(async()=>{const s=N*a,t=Math.min(N*a+a,e.size),r=u>1?e.slice(s,t):e,l={partName:u>1?`${c}.part.${A(N+1,3)}`:c,fileName:c,partNo:N+1,encrypted:n,channelId:x};return await ls(m,r,l,i,(e=>{g[N]=e}))})())));const y=setInterval((()=>{const e=g.reduce(((e,s)=>e+s),0);l(e/u)}),1e3);i.addEventListener("abort",(()=>{h.clearQueue(),clearInterval(y)}));const j=await Promise.all(v),b=p.concat(j).sort(((e,s)=>e.partNo-s.partNo)).map((e=>({id:e.partId,salt:e.salt}))),w={name:c,mimeType:e.type??"application/octet-stream",type:"file",parts:b,size:e.size,path:s,encrypted:n,channelId:x};await o(w),await L.DELETE("/uploads/{id}",{params:{path:{id:f}}}),clearInterval(y)})(a.file,y||"/",Number(i.splitFileSize),null==l?void 0:l.userId,Number(i.uploadConcurrency),Boolean(i.encryptFiles),a.controller.signal,(e=>n.setProgress(a.id,e)),(async e=>{await h.mutateAsync({body:e}),h.isSuccess&&n.setFileUploadStatus(a.id,te.UPLOADED)})).then((()=>{n.setFileUploadStatus(a.id,te.UPLOADED),n.startNextUpload()})).catch((e=>{P.error(e.message)})))}),[null==a?void 0:a.id]),m.jsxs("div",{className:"fixed right-10 bottom-10",children:[m.jsx("input",{className:"opacity-0",ref:o,type:"file",multiple:!0,onChange:d}),s.length>0&&m.jsxs("div",{className:"max-w-xs",children:[m.jsxs("div",{className:p("shadow-md w-full flex items-center gap-2","px-4 py-2 text-sm font-medium bg-surface-container min-h-12",t?"rounded-lg":"rounded-t-lg"),children:[m.jsx("span",{children:"Upload"}),m.jsxs("span",{className:"text-label-medium",children:[s.length," ",s.length>1?"files":"file"]}),m.jsxs("div",{className:"inline-flex gap-2 ml-auto",children:[m.jsx(x,{variant:"text",className:"text-inherit",isIconOnly:!0,onPress:n.toggleCollapse,children:t?m.jsx(Ae,{}):m.jsx(qe,{})}),m.jsx(x,{variant:"text",className:"text-inherit",isIconOnly:!0,onPress:n.cancelUpload,children:m.jsx(Le,{})})]})]}),m.jsx(z,{"aria-label":"Upload Files",isVirtualized:s.length>100,className:p("max-w-xs rounded-none rounded-b-lg dark:bg-surface-container-lowest bg-surface shadow-md","transition-[max-height] duration-300 ease-in-out select-none",O,t?"max-h-0 overflow-hidden":"max-h-80 overflow-y-auto"),children:s.map(((e,s)=>m.jsx(D,{className:"data-[hover=true]:bg-transparent px-0",textValue:e,children:m.jsx(os,{id:e})},e)))})]})]})};let ds=!0;const us=[ee.RenameFile.id,ee.CreateFolder.id,ee.DeleteFiles.id,X.ShareFiles.id],hs=E("/_authed/$view"),fs=new Map,ms=f.memo((()=>{const{view:e}=hs.useParams(),s=hs.useSearch(),a=f.useRef(null),[t]=I(),r={view:e,params:s},n=B.list(r,null==t?void 0:t.hash),i=H((e=>e.open)),l=H((e=>e.operation)),o=se((e=>e.uploadOpen)),{breakpoint:c}=ie(K),{data:d,fetchNextPage:u,hasNextPage:h,isFetchingNextPage:p}=le(n),x=oe(r,t),v=f.useMemo((()=>"my-drive"===e?R((null==s?void 0:s.path)||"").map((([e,s],a)=>({id:a+e,name:e,path:s,isDir:!0,chain:!0}))):[]),[null==s?void 0:s.path,e]);return f.useEffect((()=>{if(!ds)return setTimeout((()=>{var t,r;null==(r=a.current)||r.scrollTo({top:(null==(t=fs.get(e+(null==s?void 0:s.path)||""))?void 0:t.scrollTop)??0,left:0})}),0),()=>{var t;a.current&&void 0!==a.current.getState&&(null==(t=a.current)||t.getState((a=>fs.set(e+(null==s?void 0:s.path)||"",a))))};ds=!1}),[null==s?void 0:s.path,e]),m.jsxs("div",{className:"size-full m-auto",children:[m.jsxs(ce,{files:d,folderChain:v,onFileAction:x(),fileActions:de,defaultFileViewActionId:$,defaultSortActionId:"my-drive"===e?U.sortId:_[e].sortId,defaultSortOrder:"my-drive"===e?U.order:_[e].order,breakpoint:c,children:["my-drive"===e&&m.jsx(ue,{breakpoint:c}),m.jsx(he,{className:"my-drive"!==e?"pt-2":""}),m.jsx(fe,{hasNextPage:h,isNextPageLoading:p,loadNextPage:u,ref:a}),m.jsx(me,{})]}),us.find((e=>e===l))&&i&&m.jsx(ze,{queryKey:n.queryKey}),l===ee.OpenFiles.id&&i&&m.jsx(pe,{session:t,files:d,path:(null==s?void 0:s.path)||"",view:e}),o&&m.jsx(cs,{queryKey:n.queryKey})]})})),ps=V("/_authed/$view")({component:ms});export{ps as Route};
